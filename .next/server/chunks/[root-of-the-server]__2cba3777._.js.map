{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/gnickles/Desktop/AspFumi_Site/src/lib/geocoding.ts"],"sourcesContent":["// This is a reusable, server-side function to get coordinates for a given location.\n\nexport async function getCoordinates(city: string, state: string, country: string): Promise<{ lat: number; lng: number; matchLevel: string } | null> {\n    const queries = [`${city}, ${state}, ${country}`, `${city}, ${country}`, `${state}, ${country}`, country].filter(q => q.trim() !== ',' && q.trim().length > 1);\n    for (const query of queries) {\n        try {\n            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&accept-language=en&limit=1`;\n            const response = await fetch(url, { headers: { 'User-Agent': 'Aspergillus Community Sequencing Project' } });\n            if (response.ok) {\n                const data = await response.json();\n                if (data && data.length > 0) {\n                    const result = data[0];\n                    let matchLevel = 'country';\n                    const addressType = result.addresstype;\n                    if (['city', 'town', 'village', 'hamlet'].includes(addressType)) {\n                        matchLevel = 'city';\n                    } else if (['state', 'province', 'region', 'county'].includes(addressType)) {\n                        matchLevel = 'state';\n                    }\n                    return { lat: parseFloat(result.lat), lng: parseFloat(result.lon), matchLevel };\n                }\n            }\n        } catch (error) { console.error(`Geocoding error for query \"${query}\":`, error); }\n    }\n    return null;\n}\n"],"names":[],"mappings":"AAAA,oFAAoF;;;;;AAE7E,eAAe,eAAe,IAAY,EAAE,KAAa,EAAE,OAAe;IAC7E,MAAM,UAAU;QAAC,GAAG,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,SAAS;QAAE,GAAG,KAAK,EAAE,EAAE,SAAS;QAAE,GAAG,MAAM,EAAE,EAAE,SAAS;QAAE;KAAQ,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,OAAO,OAAO,EAAE,IAAI,GAAG,MAAM,GAAG;IAC5J,KAAK,MAAM,SAAS,QAAS;QACzB,IAAI;YACA,MAAM,MAAM,CAAC,yDAAyD,EAAE,mBAAmB,OAAO,2BAA2B,CAAC;YAC9H,MAAM,WAAW,MAAM,MAAM,KAAK;gBAAE,SAAS;oBAAE,cAAc;gBAA2C;YAAE;YAC1G,IAAI,SAAS,EAAE,EAAE;gBACb,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,IAAI,QAAQ,KAAK,MAAM,GAAG,GAAG;oBACzB,MAAM,SAAS,IAAI,CAAC,EAAE;oBACtB,IAAI,aAAa;oBACjB,MAAM,cAAc,OAAO,WAAW;oBACtC,IAAI;wBAAC;wBAAQ;wBAAQ;wBAAW;qBAAS,CAAC,QAAQ,CAAC,cAAc;wBAC7D,aAAa;oBACjB,OAAO,IAAI;wBAAC;wBAAS;wBAAY;wBAAU;qBAAS,CAAC,QAAQ,CAAC,cAAc;wBACxE,aAAa;oBACjB;oBACA,OAAO;wBAAE,KAAK,WAAW,OAAO,GAAG;wBAAG,KAAK,WAAW,OAAO,GAAG;wBAAG;oBAAW;gBAClF;YACJ;QACJ,EAAE,OAAO,OAAO;YAAE,QAAQ,KAAK,CAAC,CAAC,2BAA2B,EAAE,MAAM,EAAE,CAAC,EAAE;QAAQ;IACrF;IACA,OAAO;AACX","debugId":null}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///Users/gnickles/Desktop/AspFumi_Site/src/app/api/submit-metadata/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n// IMPORT THE DATABASE DRIVER\nimport { neon } from '@neondatabase/serverless';\n// Importing the geocoding function\nimport { getCoordinates } from '@/lib/geocoding';\n\n// This interface defines the data we expect from the form\ninterface SubmissionData {\n  labName: string; institution: string; city: string; state: string; country: string;\n  contactName: string; contactEmail: string; researchUse: string; comments: string;\n}\n//\nexport async function POST(request: NextRequest) {\n  try {\n    const data: SubmissionData = await request.json();\n    const sql = neon(process.env.POSTGRES_URL!);\n    \n    // We now call the imported function. The logic from here down is the same as before.\n    const coordinates = await getCoordinates(data.city, data.state, data.country);\n\n    await sql`\n      INSERT INTO lab_submissions (\n        lab_name, institution, city, state, country, \n        contact_name, contact_email, research_use, comments, \n        latitude, longitude, match_level\n      ) VALUES (\n        ${data.labName}, ${data.institution}, ${data.city}, ${data.state}, ${data.country},\n        ${data.contactName}, ${data.contactEmail}, ${data.researchUse}, ${data.comments},\n        ${coordinates?.lat || null}, ${coordinates?.lng || null}, ${coordinates?.matchLevel || 'none'}\n      );\n    `;\n\n    let successMessage = 'Metadata submitted successfully';\n    if (coordinates) {\n        successMessage += ` Your laboratory will appear on our global map shortly (matched at ${coordinates.matchLevel} level).`;\n    } else {\n        successMessage += '. Note: Your location could not be automatically mapped and will be reviewed manually.';\n    }\n\n    return NextResponse.json({ success: true, message: successMessage });\n  } catch (error) {\n    console.error('Error processing submission:', error);\n    return NextResponse.json({ error: 'Internal server error while processing submission.' }, { status: 500 });\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA,6BAA6B;AAC7B;AACA,mCAAmC;AACnC;;;;AAQO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAuB,MAAM,QAAQ,IAAI;QAC/C,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;QAEzC,qFAAqF;QACrF,MAAM,cAAc,MAAM,IAAA,2IAAc,EAAC,KAAK,IAAI,EAAE,KAAK,KAAK,EAAE,KAAK,OAAO;QAE5E,MAAM,GAAG,CAAC;;;;;;QAMN,EAAE,KAAK,OAAO,CAAC,EAAE,EAAE,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC,EAAE,EAAE,KAAK,KAAK,CAAC,EAAE,EAAE,KAAK,OAAO,CAAC;QAClF,EAAE,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,YAAY,CAAC,EAAE,EAAE,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,QAAQ,CAAC;QAChF,EAAE,aAAa,OAAO,KAAK,EAAE,EAAE,aAAa,OAAO,KAAK,EAAE,EAAE,aAAa,cAAc,OAAO;;IAElG,CAAC;QAED,IAAI,iBAAiB;QACrB,IAAI,aAAa;YACb,kBAAkB,CAAC,mEAAmE,EAAE,YAAY,UAAU,CAAC,QAAQ,CAAC;QAC5H,OAAO;YACH,kBAAkB;QACtB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAe;IACpE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqD,GAAG;YAAE,QAAQ;QAAI;IAC1G;AACF","debugId":null}}]
}