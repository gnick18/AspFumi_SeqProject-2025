{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/gnickles/Desktop/AspFumi_Site/src/app/api/admin/isolates/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n// IMPORT THE DATABASE DRIVER\nimport { neon } from '@neondatabase/serverless';\n\n// The interface for a row in our table. Note: 'id' is now a number.\ninterface IsolateData {\n  id: number;\n  [key: string]: unknown; \n}\n\n// --- API Methods ---\n// GET: Fetches all lab submissions from the database\nexport async function GET() {\n  const sql = neon(process.env.POSTGRES_URL!);\n  try {\n    const submissions = await sql`SELECT * FROM isolate_submissions ORDER BY timestamp DESC`;\n    return NextResponse.json({ submissions });\n  } catch (error) {\n    console.error(\"Database GET Error (isolates):\", error);\n    return NextResponse.json({ error: \"Failed to fetch isolate data.\" }, { status: 500 });\n  }\n}\n\n// ADDED POST FUNCTION\nexport async function POST(request: NextRequest) {\n  const sql = neon(process.env.POSTGRES_URL!);\n  try {\n    const rawBodyText = await request.text();\n    console.log('Received RAW TEXT body:', rawBodyText);\n    //\n    let body;\n    try {\n      body = JSON.parse(rawBodyText);\n    } catch(parseError) {\n      console.error(\"JSON PARSE FAILED:\", parseError);\n      return NextResponse.json(\n          { error: \"Malformed JSON request body.\" },\n          { status: 400 } // This 400 is now explicitly reporting a bad JSON format\n      );\n    }\n    \n    // 1. Destructure all fields, providing default empty strings for optional fields\n    const {\n      submitting_lab,\n      strain_name,\n      genotype,\n      other_genes,\n      other_mutations = '', // Default to empty string\n      strain_origin = '',    // Default to empty string\n      strain_center_name = '',\n      strain_center_location = '',\n      strain_center_date = '',\n      sharing_lab_name = '',\n      sharing_lab_institute = '',\n      sharing_lab_location = '',\n    } = body;\n    \n    // 2. Use the destructured variables for required fields check\n    if (!submitting_lab || !strain_name) {\n      return NextResponse.json(\n        { error: \"Missing required fields: submitting_lab or strain_name\" },\n        { status: 400 }\n      );\n    }\n\n    const genotypeDetailsJson = JSON.stringify(genotype);\n    const otherGenesJson = JSON.stringify(other_genes);\n\n    await sql`\n      INSERT INTO isolate_submissions (\n        submitting_lab, strain_name, strain_origin,\n        strain_center_name, strain_center_location, strain_center_date,\n        sharing_lab_name, sharing_lab_institute, sharing_lab_location,\n        genotype_details_json, other_genes_json, other_mutations\n      ) VALUES (\n        ${submitting_lab}, ${strain_name}, ${strain_origin},\n        ${strain_center_name}, ${strain_center_location}, ${strain_center_date},\n        ${sharing_lab_name}, ${sharing_lab_institute}, ${sharing_lab_location},\n        ${genotypeDetailsJson},\n        ${otherGenesJson},\n        ${other_mutations}\n      );\n    `;\n\n    return NextResponse.json({ message: \"Isolate information submitted successfully!\" }, { status: 200 });\n\n  } catch (error) {\n    console.error(\"Database POST Error (isolates):\", error);\n    return NextResponse.json({ error: \"Failed to submit isolate data.\" }, { status: 500 });\n  }\n}\n\n// PUT: For updating existing records from the admin panel\nexport async function PUT(request: NextRequest) {\n  try {\n    const updatedRow: IsolateData = await request.json();\n    const sql = neon(process.env.POSTGRES_URL!);\n    await sql`\n      UPDATE isolate_submissions\n      SET\n        submitting_lab = ${updatedRow.submitting_lab as string},\n        strain_name = ${updatedRow.strain_name as string},\n        strain_origin = ${updatedRow.strain_origin as string},\n        strain_center_name = ${updatedRow.strain_center_name as string},\n        strain_center_location = ${updatedRow.strain_center_location as string},\n        strain_center_date = ${updatedRow.strain_center_date as string},\n        sharing_lab_name = ${updatedRow.sharing_lab_name as string},\n        sharing_lab_institute = ${updatedRow.sharing_lab_institute as string},\n        sharing_lab_location = ${updatedRow.sharing_lab_location as string},\n        genotype_details_json = ${updatedRow.genotype_details_json as string},\n        other_genes_json = ${updatedRow.other_genes_json as string},\n        other_mutations = ${updatedRow.other_mutations as string}\n      WHERE id = ${updatedRow.id};\n    `;\n    return NextResponse.json({ success: true, updatedRow: updatedRow });\n  } catch (error) {\n    console.error(\"Database PUT Error (isolates):\", error);\n    return NextResponse.json({ error: \"Failed to update isolate data.\" }, { status: 500 });\n  }\n}\n\n// DELETE: For deleting records from the admin panel\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { id } = await request.json();\n    const sql = neon(process.env.POSTGRES_URL!);\n    await sql`DELETE FROM isolate_submissions WHERE id = ${id}`;\n    return NextResponse.json({ success: true });\n  } catch(error) {\n    console.error(\"Database DELETE Error (isolates):\", error);\n    return NextResponse.json({ error: \"Failed to delete isolate data.\" }, { status: 500 });\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}