{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/gnickles/Desktop/AspFumi_Site/src/components/GlobalMap.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useMemo, useRef } from 'react';\n// You may need to run `npm install --save-dev @types/leaflet` in your terminal if you haven't already.\nimport type L from 'leaflet';\n\n// --- TYPE DEFINITIONS ---\ninterface Lab {\n  id: string;\n  name: string;\n  location: string;\n  country: string;\n  lat: number;\n  lng: number;\n  institution?: string;\n}\n\ninterface GroupedLabs {\n  [key: string]: Lab[];\n}\n\n// Augment the Window interface to tell TypeScript what 'window.L' will look like.\ndeclare global {\n  interface Window {\n    L: typeof L;\n  }\n}\n\nconst GlobalMap = () => {\n  const [labs, setLabs] = useState<Lab[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [leafletLoaded, setLeafletLoaded] = useState(false);\n\n  const mapContainerRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<L.Map | null>(null);\n\n  // --- EFFECT 1: Load Leaflet Library from CDN ---\n  useEffect(() => {\n    if (window.L) {\n      setLeafletLoaded(true);\n      return;\n    }\n    const cssLink = document.createElement('link');\n    cssLink.rel = 'stylesheet';\n    cssLink.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';\n    document.head.appendChild(cssLink);\n    \n    const script = document.createElement('script');\n    script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';\n    script.async = true;\n    script.onload = () => setLeafletLoaded(true);\n    document.body.appendChild(script);\n\n    return () => { // Cleanup function\n      if (document.head.contains(cssLink)) {\n        document.head.removeChild(cssLink);\n      }\n      if (document.body.contains(script)) {\n        document.body.removeChild(script);\n      }\n    };\n  }, []);\n\n  // --- EFFECT 2: Fetch Lab Data ---\n  useEffect(() => {\n    const loadLabs = async () => {\n      try {\n        const response = await fetch('/api/labs');\n        if (response.ok) {\n          const data = await response.json();\n          setLabs(data.labs || []);\n        }\n      } catch (error) {\n        console.error('Failed to load lab data:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n    loadLabs();\n  }, []);\n\n  // --- DATA PROCESSING: Group labs by location ---\n  const groupedLabs = useMemo(() => {\n    return labs.reduce((acc, lab) => {\n      const key = `${lab.lat},${lab.lng}`;\n      if (!acc[key]) acc[key] = [];\n      acc[key].push(lab);\n      return acc;\n    }, {} as GroupedLabs);\n  }, [labs]);\n  \n  // --- EFFECT 3: Initialize and Update the Map ---\n  useEffect(() => {\n    if (!leafletLoaded || !mapContainerRef.current || loading) return;\n\n    const L = window.L;\n\n    if (!mapInstanceRef.current) {\n      mapInstanceRef.current = L.map(mapContainerRef.current).setView([40, 0], 2);\n      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n      }).addTo(mapInstanceRef.current);\n    }\n    \n    mapInstanceRef.current.eachLayer((layer: L.Layer) => {\n      if (layer instanceof L.Marker) {\n        mapInstanceRef.current?.removeLayer(layer);\n      }\n    });\n\n    const customIcon = L.divIcon({\n      html: `<div style=\"background-color: #1b4d3e; border: 3px solid #52b788; border-radius: 50%; width: 22px; height: 22px; box-shadow: 0 2px 6px rgba(27, 77, 62, 0.4);\"></div>`,\n      className: 'custom-div-icon',\n      iconSize: [22, 22], iconAnchor: [11, 11], popupAnchor: [0, -11]\n    });\n\n    Object.values(groupedLabs).forEach((labGroup) => {\n      const firstLab = labGroup[0];\n      const position: [number, number] = [firstLab.lat, firstLab.lng];\n      const popupContent = `<div class=\"p-1 max-h-48 overflow-y-auto\" style=\"font-family: Inter, sans-serif;\">${labGroup.map(lab => `<div class=\"mb-3 border-l-2 border-green-300 pl-2\"><h4 class=\"font-semibold text-sm mb-1\" style=\"color: #333;\">${lab.name}</h4><p class=\"text-xs opacity-75\" style=\"color: #555;\">${lab.institution || ''}${lab.institution && lab.country ? ', ' : ''}${lab.country}</p></div>`).join('')}</div>`;\n      L.marker(position, { icon: customIcon }).addTo(mapInstanceRef.current!).bindPopup(popupContent);\n    });\n\n  }, [leafletLoaded, loading, groupedLabs]);\n\n  if (loading) {\n    return (\n      <div className=\"h-96 bg-gray-100 rounded-lg flex items-center justify-center border border-gray-200\">\n        <p className=\"text-gray-500\">Loading map...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-96 w-full rounded-lg overflow-hidden shadow-lg\">\n      <div ref={mapContainerRef} style={{ height: '100%', width: '100%' }} />\n    </div>\n  );\n};\n\nexport default GlobalMap;\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///Users/gnickles/Desktop/AspFumi_Site/src/app/map/page.tsx"],"sourcesContent":["'use client';\n\nimport GlobalMap from '@/components/GlobalMap';\nimport { useState, useEffect } from 'react';\n\ninterface Lab {\n  id: string;\n  name: string;\n  location: string;\n  country: string;\n  lat: number;\n  lng: number;\n  institution?: string;\n}\n\nexport default function MapPage() {\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <h2 className=\"text-3xl font-bold mb-8\" style={{ color: 'var(--primary)' }}>\n        Map\n      </h2>\n\n      <div className=\"popup-card p-6 rounded-lg mb-8\">\n        <p className=\"text-base leading-relaxed mb-4\">\n          This interactive map displays the locations of research laboratories participating in the\n          <em> Aspergillus fumigatus</em> Af293/CEA10 Community Sequencing Initiative. Each marker\n          represents a laboratory that has joined our collaborative effort.\n        </p>\n        <p className=\"text-sm\" style={{ color: 'var(--dark-grey)' }}>\n          Click on any marker to view more information about that laboratory.\n        </p>\n      </div>\n\n      <div className=\"mb-8\">\n        <GlobalMap />\n      </div>\n\n      <ParticipatingLabsList />\n    </div>\n  );\n}\n\nfunction ParticipatingLabsList() {\n  const [labs, setLabs] = useState<Lab[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const loadLabs = async () => {\n      try {\n        const response = await fetch('/api/labs');\n        if (response.ok) {\n          const data = await response.json();\n          if (data.success) {\n            setLabs(data.labs);\n          }\n        }\n      } catch (error) {\n        console.error('Failed to load lab data:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadLabs();\n  }, []);\n\n  return (\n    <div className=\"popup-card p-6 rounded-lg mb-8\">\n      <h3 className=\"text-xl font-semibold\" style={{ color: 'var(--secondary)' }}>\n        Current Participating Labs\n      </h3>\n      <p className=\"text-sm\" style={{ color: 'var(--dark-grey)' }}>\n        via Sample Submission or Admin Support\n      </p>\n      <br />\n      \n\n      {loading ? (\n        <p className=\"text-sm\" style={{ color: 'var(--dark-grey)' }}>Loading participating labs...</p>\n      ) : labs.length === 0 ? (\n        <p className=\"text-sm\" style={{ color: 'var(--dark-grey)' }}>No participating labs yet. Be the first to join!</p>\n      ) : (\n        <div className=\"space-y-4\">\n          {labs.map((lab) => (\n            <div key={lab.id} className=\"flex items-start gap-3\">\n              <div className=\"w-3 h-3 rounded-full mt-1.5 flex-shrink-0\" style={{ backgroundColor: 'var(--soft-green)' }}></div>\n              <div>\n                <p className=\"font-medium text-sm\">{lab.name} at {lab.institution}</p>\n                {lab.location && (\n                  <p className=\"text-xs opacity-75\">{lab.location}</p>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      <div className=\"mt-6 pt-4 border-t\" style={{ borderColor: 'var(--light-grey)' }}>\n        <p className=\"text-sm mb-3\" style={{ color: 'var(--dark-grey)' }}>\n          The map automatically updates when new laboratories complete the metadata form and join our initiative.\n        </p>\n        <div className=\"text-center\">\n          <a\n            href=\"/join\"\n            className=\"inline-block px-6 py-2 rounded text-sm font-medium transition-colors\"\n            style={{\n              backgroundColor: 'var(--soft-green)',\n              color: 'var(--dark-green)',\n              border: '1px solid var(--dark-green)'\n            }}\n          >\n            Learn How to Join\n          </a>\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAee,SAAS;IACtB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;gBAA0B,OAAO;oBAAE,OAAO;gBAAiB;0BAAG;;;;;;0BAI5E,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;;4BAAiC;0CAE5C,8OAAC;0CAAG;;;;;;4BAA2B;;;;;;;kCAGjC,8OAAC;wBAAE,WAAU;wBAAU,OAAO;4BAAE,OAAO;wBAAmB;kCAAG;;;;;;;;;;;;0BAK/D,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,0IAAS;;;;;;;;;;0BAGZ,8OAAC;;;;;;;;;;;AAGP;AAEA,SAAS;IACP,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAQ,EAAE;IAC1C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,MAAM,WAAW;YACf,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,IAAI,KAAK,OAAO,EAAE;wBAChB,QAAQ,KAAK,IAAI;oBACnB;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,4BAA4B;YAC5C,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG,EAAE;IAEL,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;gBAAwB,OAAO;oBAAE,OAAO;gBAAmB;0BAAG;;;;;;0BAG5E,8OAAC;gBAAE,WAAU;gBAAU,OAAO;oBAAE,OAAO;gBAAmB;0BAAG;;;;;;0BAG7D,8OAAC;;;;;YAGA,wBACC,8OAAC;gBAAE,WAAU;gBAAU,OAAO;oBAAE,OAAO;gBAAmB;0BAAG;;;;;uBAC3D,KAAK,MAAM,KAAK,kBAClB,8OAAC;gBAAE,WAAU;gBAAU,OAAO;oBAAE,OAAO;gBAAmB;0BAAG;;;;;qCAE7D,8OAAC;gBAAI,WAAU;0BACZ,KAAK,GAAG,CAAC,CAAC,oBACT,8OAAC;wBAAiB,WAAU;;0CAC1B,8OAAC;gCAAI,WAAU;gCAA4C,OAAO;oCAAE,iBAAiB;gCAAoB;;;;;;0CACzG,8OAAC;;kDACC,8OAAC;wCAAE,WAAU;;4CAAuB,IAAI,IAAI;4CAAC;4CAAK,IAAI,WAAW;;;;;;;oCAChE,IAAI,QAAQ,kBACX,8OAAC;wCAAE,WAAU;kDAAsB,IAAI,QAAQ;;;;;;;;;;;;;uBAL3C,IAAI,EAAE;;;;;;;;;;0BAatB,8OAAC;gBAAI,WAAU;gBAAqB,OAAO;oBAAE,aAAa;gBAAoB;;kCAC5E,8OAAC;wBAAE,WAAU;wBAAe,OAAO;4BAAE,OAAO;wBAAmB;kCAAG;;;;;;kCAGlE,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BACC,MAAK;4BACL,WAAU;4BACV,OAAO;gCACL,iBAAiB;gCACjB,OAAO;gCACP,QAAQ;4BACV;sCACD;;;;;;;;;;;;;;;;;;;;;;;AAOX","debugId":null}}]
}