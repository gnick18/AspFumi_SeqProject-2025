{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/gnickles/Desktop/AspFumi_Site/src/app/api/submit-isolate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n// IMPORT THE DATABASE DRIVER\nimport { neon } from '@neondatabase/serverless';\n\n// This interface should match the PAYLOAD from your frontend\ninterface IsolateSubmissionPayload {\n  submitting_lab: string;\n  strain_name: string;\n  genotype_details_json: string; // Now expecting a string\n  other_genes_json: string;      // Now expecting a string\n  other_mutations: string;\n  strain_origin: string;\n  strain_center_name: string;\n  strain_center_location: string;\n  strain_center_date: string;\n  sharing_lab_name: string;\n  sharing_lab_institute: string;\n  sharing_lab_location: string;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const data: IsolateSubmissionPayload = await request.json();\n\n    console.log('Received data on server:', data);\n\n    // --- FIX 1: VALIDATE USING snake_case ---\n    if (!data.submitting_lab || !data.strain_name) {\n      return NextResponse.json(\n        { error: 'Missing required fields: Submitting Lab and Strain Name.' },\n        { status: 400 }\n      );\n    }\n\n    // 2. CONNECT TO THE DATABASE\n    const sql = neon(process.env.POSTGRES_URL!);\n    \n    // --- FIX 2: NO LONGER NEED TO STRINGIFY ---\n    // The data is already coming in as a string from the frontend.\n\n    // 3. INSERT DATA INTO THE DATABASE\n    //    Using snake_case keys directly from the 'data' object\n    await sql`\n      INSERT INTO isolate_submissions (\n        submitting_lab, strain_name, strain_origin,\n        strain_center_name, strain_center_location, strain_center_date,\n        sharing_lab_name, sharing_lab_institute, sharing_lab_location,\n        genotype_details_json, other_genes_json, other_mutations\n      ) VALUES (\n        ${data.submitting_lab}, ${data.strain_name}, ${data.strain_origin},\n        ${data.strain_center_name || null}, ${data.strain_center_location || null}, ${data.strain_center_date || null},\n        ${data.sharing_lab_name || null}, ${data.sharing_lab_institute || null}, ${data.sharing_lab_location || null},\n        ${data.genotype_details_json}, ${data.other_genes_json}, ${data.other_mutations || null}\n      );\n    `;\n\n    return NextResponse.json({\n      success: true,\n      message: 'Isolate information submitted successfully!',\n    });\n\n  } catch (error) {\n    console.error('Error processing isolate submission:', error);\n    return NextResponse.json(\n      { error: 'Internal server error while processing isolate submission.' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA,6BAA6B;AAC7B;;;AAkBO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAiC,MAAM,QAAQ,IAAI;QAEzD,QAAQ,GAAG,CAAC,4BAA4B;QAExC,2CAA2C;QAC3C,IAAI,CAAC,KAAK,cAAc,IAAI,CAAC,KAAK,WAAW,EAAE;YAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2D,GACpE;gBAAE,QAAQ;YAAI;QAElB;QAEA,6BAA6B;QAC7B,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;QAEzC,6CAA6C;QAC7C,+DAA+D;QAE/D,mCAAmC;QACnC,2DAA2D;QAC3D,MAAM,GAAG,CAAC;;;;;;;QAON,EAAE,KAAK,cAAc,CAAC,EAAE,EAAE,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,aAAa,CAAC;QAClE,EAAE,KAAK,kBAAkB,IAAI,KAAK,EAAE,EAAE,KAAK,sBAAsB,IAAI,KAAK,EAAE,EAAE,KAAK,kBAAkB,IAAI,KAAK;QAC9G,EAAE,KAAK,gBAAgB,IAAI,KAAK,EAAE,EAAE,KAAK,qBAAqB,IAAI,KAAK,EAAE,EAAE,KAAK,oBAAoB,IAAI,KAAK;QAC7G,EAAE,KAAK,qBAAqB,CAAC,EAAE,EAAE,KAAK,gBAAgB,CAAC,EAAE,EAAE,KAAK,eAAe,IAAI,KAAK;;IAE5F,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6D,GACtE;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}